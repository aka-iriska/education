     1                                  section .data
     2 00000000 D098D0B7D0BDD0B0D1-         FormerMsg db "РР·РЅР°С‡Р°Р»СЊРЅС‹Р№ С‚РµРєСЃС‚: ", 10
     2 00000009 87D0B0D0BBD18CD0BD-
     2 00000012 D18BD0B920D182D0B5-
     2 0000001B D0BAD181D1823A200A 
     3                                      lenFormerMsg equ $-FormerMsg
     4 00000024 D09ED182D181D0BED1-         SortedMsg db "РћС‚СЃРѕСЂС‚РёСЂРѕРІР°РЅРЅС‹Р№ С‚РµРєСЃС‚:", 10
     4 0000002D 80D182D0B8D180D0BE-
     4 00000036 D0B2D0B0D0BDD0BDD1-
     4 0000003F 8BD0B920D182D0B5D0-
     4 00000048 BAD181D1823A0A     
     5                                      lenSortedMsg equ $-SortedMsg
     6 0000004F 4572726F723A20496E-         ErrorStr db "Error: Invalid input format", 10
     6 00000058 76616C696420696E70-
     6 00000061 757420666F726D6174-
     6 0000006A 0A                 
     7                                      lenError equ $-ErrorStr
     8                                      ;Text db "СЂР°РґСѓР№СЃСЏ РєР°Р¶РґРѕРјСѓ РјРѕРјРµРЅС‚Сѓ СЂР°Р·РЅРѕРіРѕ СЃС‡Р°СЃС‚СЊСЏ", 10
     9                                      ;Text db "Р”Р›Р’РџР РќРћ РђРџР Р¦РЈРџР  РџР Р’РђР Р Р’ РђР РџР’РђРџР  РџР РћР’РђРџР ", 10
    10 0000006B D094D090D09BD081D0-         Text db "Р”РђР›РЃРљРР™ Р”РђР›РЃРљР«Р™ Р”РђР›РЃРљРР™ Р’Р•Р”РЃР РљРћ РќРђР”Р•Р–РќРћ",10
    10 00000074 9AD098D09920D094D0-
    10 0000007D 90D09BD081D09AD0AB-
    10 00000086 D09920D094D090D09B-
    10 0000008F D081D09AD098D09920-
    10 00000098 D092D095D094D081D0-
    10 000000A1 A0D09AD09E20D09DD0-
    10 000000AA 90D094D095D096D09D-
    10 000000B3 D09E0A             
    11                                      lenText equ $-Text
    12 000000B6 20<rep Ah>                  Helper times 10 db " " ;РґР»СЏ swap
    13                                  section .bss
    14                                  
    15                                  section .text
    16                                  
    17                                  global _start
    18                                  _start:
    19                                  ;РїСЂРѕРІРµСЂРєР° РЅР° РѕС€РёР±РєСѓ РІРІРѕРґР° С‚РµРєСЃС‚Р°
    20 00000000 B84B000000                  mov eax, lenText
    21 00000005 BB4B000000                  mov ebx, 75
    22 0000000A 39D8                        cmp eax, ebx
    23 0000000C 0F85FA000000                jne Error
    24                                  ;РІС‹РІРѕРґ СЃРѕРѕР±С‰РµРЅРёСЏ РѕР± РёР·РЅР°С‡Р°Р»СЊРЅРѕР№ СЃС‚СЂРѕРєРµ
    25 00000012 B804000000                  mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    26 00000017 BB01000000                  mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    27 0000001C B9[00000000]                mov ecx, FormerMsg ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    28 00000021 BA24000000                  mov edx, lenFormerMsg ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    29 00000026 CD80                        int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    30                                  ;РІС‹РІРѕРґ РёР·РЅР°С‡Р°Р»СЊРЅРѕР№ СЃС‚СЂРѕРєРё
    31 00000028 E8C8000000                  call printText
    32                                  ;СЃРѕСЂС‚РёСЂРѕРІРєР° РїСѓР·С‹СЂСЊРєРѕРј
    33 0000002D B904000000                  mov ecx, 4 ;5-1 С‡С‚РѕР±С‹ РјРѕР¶РЅРѕ Р±С‹Р»Рѕ РїРѕСЃС‚Р°РІРёС‚СЊ СѓРєР°Р·Р°С‚РµР»СЊ РїРµСЂРµРґ РїРѕСЃР»РµРґРЅРёРј СЌР»РµРјРµРЅС‚РѕРј Рё РїСЂРѕСЃРјРѕС‚СЂРµС‚СЊ РµРіРѕ
    34                                      first_iter:
    35 00000032 B805000000                  mov eax, 5 ;РІСЃРµРіРѕ СЌР»РµРјРµРЅС‚РѕРІ
    36 00000037 29C8                        sub eax, ecx ;РёРЅРґРµРєСЃ РїСЂРѕСЃРјР°С‚СЂРёРІР°РµРјРѕРіРѕ i
    37 00000039 BB00000000                  mov ebx, 0 ;СЃС‡С‘С‚С‡РёРє РґР»СЏ РІРЅСѓС‚СЂРµРЅРЅРµРіРѕ С†РёРєР»Р°, 0 РґР»СЏ СѓСЃС‚Р°РЅРѕРІРєРё СѓРєР°Р·Р°С‚РµР»СЏ РїРµСЂРµРґ РїРµСЂРІС‹Рј СЌР»РµРјРµРЅС‚РѕРј
    38 0000003E 93                          xchg eax, ebx ;РјРµРЅСЏРµРј Р·РЅР°С‡РµРЅРёСЏ ebx Рё eax РґР»СЏ СѓРґРѕР±СЃС‚РІР°
    39 0000003F 51                          push ecx
    40 00000040 50                          push eax
    41                                      second_iter:
    42 00000041 B905000000                      mov ecx, 5 ;РЅРµ РЅРµСЃС‘С‚ Р±РѕР»СЊС€РѕРіРѕ СЃРјС‹СЃР»Р°, Р±РѕР»СЊС€Рµ СЃР»СѓР¶РёС‚ РґР»СЏ РїСЂРѕРґРѕР»Р¶РµРЅРёСЏ СЂР°Р±РѕС‚С‹ РІРЅСѓС‚СЂРµРЅРЅРµРіРѕ С†РёРєР»Р°, РїСЂРѕРІРµСЂРєР° Рё РѕР±РЅСѓР»РµРЅРёРµ С†РёРєР»Р° РІ РєРѕРЅС†Рµ second_iter
    43 00000046 51                              push ecx
    44 00000047 E843000000                      call load ;Р·Р°РіСЂСѓР·РєР° СЌР»РµРјРµРЅС‚РѕРІ a[j] РІ esi Рё a[j+1] РІ edi
    45 0000004C B90F000000                      mov ecx, 15 ;РїСЂРѕСЃРјР°С‚СЂРёРІР°РµРј РїРµСЂРІС‹Рµ 15 Р±Р°Р№С‚РѕРІ 7*2 + 1 РЅР° СЃРѕРІРїР°РґРµРЅРёРµ
    46 00000051 F3A6                            repe cmpsb
    47 00000053 7C05                            jl next ;РµСЃР»Рё a[j]<a[j+1] РёРґС‘Рј РґР°Р»СЊС€Рµ
    48 00000055 E84E000000                      call swap ;РµСЃР»Рё a[j]>a[j+1] РјРµРЅСЏРµРј РёС… РјРµСЃС‚Р°РјРё
    49                                          next:
    50 0000005A 40                              inc eax ;СѓРІРµР»РёС‡РёРІР°РµРј СЃС‡С‘С‚С‡РёРє second_iter
    51 0000005B 59                              pop ecx
    52 0000005C 29D9                            sub ecx, ebx ;СЃС‡РёС‚Р°РµРј РіСЂР°РЅРёС‡РЅРѕРµ Р·РЅР°С‡РµРЅРёРµ РІС‚РѕСЂРѕРіРѕ РёС‚РµСЂР°С‚РѕСЂР° N-i
    53 0000005E 39C8                            cmp eax, ecx ;СЃСЂР°РІРЅРёРІР°РµРј РєРѕР»РёС‡РµСЃС‚РІРѕ СѓР¶Рµ РїСЂРѕРІРµСЂРµРЅРЅС‹С… СЌР»РµРјРµРЅС‚РѕРІ СЃ РіСЂР°РЅРёС‡РЅС‹Рј Р·РЅР°С‡РµРЅРёРµРј
    54 00000060 7402                            je exit_second ;РµСЃР»Рё РґРѕСЃС‚РёРіР»Рё РєРѕРЅС†Р° С†РёРєР»Р° РІС‹С…РѕРґ
    55 00000062 EB05                            jmp cont
    56 00000064 B901000000                      exit_second: mov ecx, 1 ;РІС‹С…РѕРґ РѕСЃСѓС‰РµСЃС‚РІР»СЏРµРј СЂСѓС‡РЅС‹Рј РѕР±РЅСѓР»РµРЅРёРµРј ecx, РїСЂРё РІС‹Р·РѕРІРµ loop ecx СЃС‚Р°РЅРµС‚ = 0 Рё Р±СѓРґРµС‚ РїСЂРѕРёР·РІРµРґРµРЅ РІС‹С…РѕРґ РёР· С†РёРєР»Р°
    57 00000069 E2D6                            cont: loop second_iter
    58 0000006B 58                          pop eax
    59 0000006C 59                          pop ecx
    60 0000006D E2C3                        loop first_iter
    61                                  ;РІС‹РІРѕРґ СЃРѕРѕР±С‰РµРЅРёСЏ Рѕ СЃРѕСЂС‚РёСЂРѕРІР°РЅРЅРѕР№ СЃС‚СЂРѕРєРµ
    62 0000006F B804000000                  mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    63 00000074 BB01000000                  mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    64 00000079 B9[24000000]                mov ecx, SortedMsg ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    65 0000007E BA2B000000                  mov edx, lenSortedMsg ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    66 00000083 CD80                        int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    67                                  ;РІС‹РІРѕРґ СЃРѕСЂС‚РёСЂРѕРІР°РЅРЅРѕР№ СЃС‚СЂРѕРєРё
    68 00000085 E86B000000                  call printText
    69 0000008A E995000000                  jmp Exit
    70                                  load:
    71 0000008F 50                          push eax
    72 00000090 53                          push ebx
    73 00000091 BB0F000000                  mov ebx, 15
    74 00000096 F7E3                        mul ebx ;eax*15
    75 00000098 8DB0[6B000000]              lea esi, [Text + eax] ;СЌР»РµРјРµРЅС‚ j
    76 0000009E 8DBC18[6B000000]            lea edi, [Text + eax+ebx] ; СЌР»РµРјРµРЅС‚ j+1
    77 000000A5 5B                          pop ebx
    78 000000A6 58                          pop eax
    79 000000A7 C3                          ret
    80                                  swap:
    81 000000A8 50                          push eax
    82 000000A9 53                          push ebx
    83 000000AA 51                          push ecx
    84 000000AB 56                          push esi
    85 000000AC 57                          push edi
    86 000000AD BB0F000000                  mov ebx, 15
    87 000000B2 F7E3                        mul ebx
    88                                      ; k:=a[j]
    89 000000B4 B90E000000                  mov ecx, 14
    90 000000B9 8DB0[6B000000]              lea esi, [Text + eax]
    91 000000BF 8D3D[B6000000]              lea edi, [Helper]
    92 000000C5 F3A4                        rep movsb
    93                                      ; a[j]:=a[j+1]
    94 000000C7 B90E000000                  mov ecx, 14
    95 000000CC 8DB418[6B000000]            lea esi, [Text + eax + ebx]
    96 000000D3 8DB8[6B000000]              lea edi, [Text+eax]
    97 000000D9 F3A4                        rep movsb
    98                                      ; a[j+1] := k
    99 000000DB B90E000000                  mov ecx, 14
   100 000000E0 8D35[B6000000]              lea esi, [Helper]
   101 000000E6 8DBC18[6B000000]            lea edi, [Text+eax+ebx]
   102 000000ED F3A4                        rep movsb
   103 000000EF 5F                          pop edi
   104 000000F0 5E                          pop esi
   105 000000F1 59                          pop ecx
   106 000000F2 5B                          pop ebx
   107 000000F3 58                          pop eax
   108 000000F4 C3                          ret
   109                                  printText:
   110 000000F5 B804000000                  mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
   111 000000FA BB01000000                  mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
   112 000000FF B9[6B000000]                mov ecx, Text ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
   113 00000104 BA4B000000                  mov edx, lenText ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
   114 00000109 CD80                        int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
   115 0000010B C3                          ret
   116                                  Error:
   117 0000010C B804000000                  mov eax, 4 ;
   118 00000111 BB01000000                  mov ebx, 1 ;
   119 00000116 B9[4F000000]                mov ecx, ErrorStr ;
   120 0000011B BA1C000000                  mov edx, lenError ;
   121 00000120 CD80                        int 80h ;
   122 00000122 EB00                        jmp Exit
   123                                  ; РІС‹С…РѕРґ
   124                                  Exit:
   125 00000124 B801000000              mov eax, 1 ;
   126 00000129 31DB                    xor ebx, ebx ;
   127 0000012B CD80                    int 80h ;
   128                                  %include "../lib.asm"
     1                              <1>     section _text
     2                              <1> StrToInt:
     3 00000000 57                  <1>          push   edi
     4 00000001 B739                <1>          mov    bh, '9'
     5 00000003 B330                <1>          mov    bl, '0'
     6 00000005 56                  <1>          push   esi     ; сохраняем адрес исходной строки
     7 00000006 803E2D              <1>          cmp    byte[esi], '-'
     8 00000009 7501                <1>          jne   .prod
     9 0000000B 46                  <1>          inc    esi     ; пропускаем знак
    10 0000000C FC                  <1> .prod    cld
    11 0000000D 6631FF              <1>          xor    di, di  ; обнуляем будущее число
    12 00000010 AC                  <1> .cycle:  lodsb          ; загружаем символ (цифру)
    13 00000011 3C0A                <1>          cmp    al, 10  ; если 10, то на конец
    14 00000013 741F                <1>          je     .Return
    15 00000015 38D8                <1>          cmp    al, bl  ; сравниваем с кодом нуля
    16 00000017 722F                <1>          jb     .Error  ; "ниже" – Ошибка
    17 00000019 38F8                <1>          cmp    al, bh  ; сравниваем с кодом девяти 
    18 0000001B 772B                <1>          ja     .Error  ; "выше" – Ошибка
    19 0000001D 2C30                <1>          sub    al, 30h ; получаем цифру из символа
    20 0000001F 6698                <1>          cbw            ; расширяем до слова
    21 00000021 6650                <1>          push   ax      ; сохраняем в стеке
    22 00000023 66B80A00            <1>          mov    ax, 10  ; заносим 10 в AX
    23 00000027 66F7E7              <1>          mul    di      ; умножаем, результат в DX:AX
    24 0000002A 665F                <1>          pop    di      ; в DI – очередная цифра
    25 0000002C 6601F8              <1>          add    ax, di
    26 0000002F 6689C7              <1>          mov    di, ax  ; в DI – накопленное число        
    27 00000032 EBDC                <1>          jmp    .cycle
    28 00000034 5E                  <1> .Return: pop    esi
    29 00000035 BB00000000          <1>          mov    ebx, 0
    30 0000003A 803E2D              <1>          cmp    byte[esi], '-'
    31 0000003D 7503                <1>          jne    .J
    32 0000003F 66F7DF              <1>          neg    di
    33 00000042 6689F8              <1> .J       mov    ax, di
    34 00000045 98                  <1>          cwde
    35 00000046 EB0B                <1>          jmp    .R
    36 00000048 5E                  <1> .Error:  pop    esi
    37 00000049 B800000000          <1>          mov    eax, 0
    38 0000004E BB01000000          <1>          mov    ebx, 1
    39 00000053 5F                  <1> .R       pop    edi
    40 00000054 C3                  <1>          ret
    41                              <1> IntToStr: 
    42 00000055 57                  <1>          push   edi
    43 00000056 53                  <1>          push   ebx
    44 00000057 52                  <1>          push   edx
    45 00000058 51                  <1>          push   ecx
    46 00000059 56                  <1> 		 push   esi
    47 0000005A C60600              <1> 		 mov    byte[esi],0 ; на место знака
    48 0000005D 83F800              <1>          cmp    eax,0
    49 00000060 7D05                <1>          jge    .l1
    50 00000062 F7D8                <1>          neg    eax
    51 00000064 C6062D              <1>          mov    byte[esi],'-'
    52 00000067 C646060A            <1> .l1      mov    byte[esi+6],10
    53 0000006B BF05000000          <1>          mov    edi,5
    54 00000070 66BB0A00            <1>          mov    bx,10
    55 00000074 6699                <1> .again:  cwd           ; расширили слово до двойного
    56 00000076 66F7F3              <1>          div    bx     ; делим результат на 10
    57 00000079 80C230              <1>          add    dl,30h ; получаем из остатка код цифры
    58 0000007C 88143E              <1>          mov    [esi+edi],dl ; пишем символ в строку
    59 0000007F 4F                  <1>          dec    edi    ; переводим указатель на  
    60                              <1>                        ; предыдущую позицию
    61 00000080 6683F800            <1>          cmp    ax, 0  ; преобразовали все число?
    62 00000084 75EE                <1>          jne    .again
    63 00000086 B906000000          <1>          mov    ecx, 6
    64 0000008B 29F9                <1>          sub    ecx, edi ; длина результата+знак
    65 0000008D 89C8                <1> 		 mov    eax,ecx
    66 0000008F 40                  <1> 		 inc    eax      ; длина результата+0А
    67 00000090 46                  <1>          inc    esi      ; пропускаем знак
    68 00000091 56                  <1> 		 push   esi
    69 00000092 8D343E              <1>          lea    esi,[esi+edi] ; начало результата
    70 00000095 5F                  <1> 		 pop    edi
    71 00000096 F3A4                <1>          rep movsb
    72 00000098 5E                  <1>          pop    esi  
    73 00000099 59                  <1>          pop    ecx
    74 0000009A 5A                  <1>          pop    edx
    75 0000009B 5B                  <1>          pop    ebx
    76 0000009C 5F                  <1>          pop    edi
    77 0000009D C3                  <1>          ret
   129                                  
