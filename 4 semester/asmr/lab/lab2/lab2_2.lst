     1                                  section .data
     2 00000000 496E70757420410A        InputA db "Input A", 10
     3                                  lenMsgA equ $-InputA
     4 00000008 496E70757420420A        InputB db "Input B", 10
     5                                  lenMsgB equ $-InputB
     6 00000010 496E707574204B0A        InputK db "Input K", 10
     7                                  lenMsgK equ $-InputK
     8 00000018 526573756C74203D20-     ResultMsg db "Result = ", 10
     8 00000021 0A                 
     9                                  lenMsgResult equ $-ResultMsg
    10 00000022 4572726F723A20496E-     ErrorStr db "Error: Invalid input format", 10
    10 0000002B 76616C696420696E70-
    10 00000034 757420666F726D6174-
    10 0000003D 0A                 
    11                                  lenError equ $-ErrorStr
    12                                  section .bss
    13 00000000 <res Ah>                InBuf resb 10 ; Р±СѓС„РµСЂ РґР»СЏ РІРІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    14                                  lenIn equ $-InBuf
    15 0000000A <res Ah>                OutBuf resb 10
    16                                  lenOut equ $-OutBuf
    17 00000014 ????????                A resd 1
    18 00000018 ????????                B resd 1
    19 0000001C ????????                K resd 1
    20 00000020 ????????                F resd 1
    21                                  section .text
    22                                  
    23                                  global _start
    24                                  _start:
    25                                  
    26                                  ;input A
    27                                  ;write
    28 00000000 B804000000              mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    29 00000005 BB01000000              mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    30 0000000A B9[00000000]            mov ecx, InputA ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    31 0000000F BA08000000              mov edx, lenMsgA ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    32 00000014 CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    33                                  ; read
    34 00000016 E8FB000000              call Buffer
    35 0000001B BE[00000000]            mov esi, InBuf
    36 00000020 E8(00000000)            call StrToInt
    37 00000025 83FB00                  cmp ebx, 0
    38 00000028 0F85D2000000            jne Error
    39 0000002E A3[14000000]            mov [A], eax
    40                                  
    41                                  ;input B
    42                                  ;write
    43 00000033 B804000000              mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    44 00000038 BB01000000              mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    45 0000003D B9[08000000]            mov ecx, InputB ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    46 00000042 BA08000000              mov edx, lenMsgB ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    47 00000047 CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    48                                  ; read
    49 00000049 E8C8000000              call Buffer
    50 0000004E BE[00000000]            mov esi, InBuf
    51 00000053 E8(00000000)            call StrToInt
    52 00000058 83FB00                  cmp ebx, 0
    53 0000005B 0F859F000000            jne Error
    54 00000061 A3[18000000]            mov [B], eax
    55                                  
    56                                  ;input K
    57                                  ;write
    58 00000066 B804000000              mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    59 0000006B BB01000000              mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    60 00000070 B9[10000000]            mov ecx, InputK ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    61 00000075 BA08000000              mov edx, lenMsgK ; РґР»РёРЅР° РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    62 0000007A CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    63                                  ; read
    64 0000007C E895000000              call Buffer
    65 00000081 BE[00000000]            mov esi, InBuf
    66 00000086 E8(00000000)            call StrToInt
    67 0000008B 83FB00                  cmp ebx, 0
    68 0000008E 7570                    jne Error
    69 00000090 A3[1C000000]            mov [K], eax
    70                                  
    71                                  ;program
    72 00000095 A1[1C000000]            mov eax, [K]
    73 0000009A F7E8                    imul eax ; k^2
    74 0000009C 83C002                  add eax, 2
    75 0000009F 89C1                    mov ECX, EAX; СЃРѕС…СЂР°РЅРёРј Р·РЅР°С‡РµРЅРёРµ Р·РЅР°РјРёРЅР°С‚РµР»СЏ
    76 000000A1 A1[18000000]            mov eax, [B]
    77 000000A6 F7E8                    imul eax ; B^2
    78 000000A8 8B1D[18000000]          mov ebx, [B]
    79 000000AE F7EB                    imul ebx ; B^3
    80 000000B0 F7F9                    idiv ecx ; AX = B^3 / K^2+2
    81 000000B2 89C1                    mov ecx, eax ;СЃРѕС…СЂР°РЅРёРј Р·РЅР°С‡РµРЅРёРµ РґСЂРѕР±Рё
    82 000000B4 A1[14000000]            mov eax, [A]
    83 000000B9 F7EB                    imul ebx
    84 000000BB 29C8                    sub eax, ecx
    85 000000BD A3[20000000]            mov [F], eax
    86 000000C2 CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    87                                  
    88                                  ;output
    89 000000C4 B804000000              mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
    90 000000C9 BB01000000              mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
    91 000000CE B9[18000000]            mov ecx, ResultMsg ; Р°РґСЂРµСЃ РІС‹РІРѕРґРёРјРѕР№ СЃС‚СЂРѕРєРё
    92 000000D3 BA0A000000              mov edx, lenMsgResult ; РґР»РёРЅР° СЃС‚СЂРѕРєРё
    93 000000D8 CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
    94                                  ;РІС‹РІРѕРґ F
    95 000000DA A1[20000000]            mov eax, [F]
    96 000000DF BE[0A000000]            mov esi, OutBuf
    97 000000E4 E8(55000000)            call IntToStr
    98 000000E9 89C6                    mov esi, eax
    99 000000EB B804000000              mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 1 (write)
   100 000000F0 BB01000000              mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
   101 000000F5 B9[0A000000]            mov ecx, OutBuf ; Р°РґСЂРµСЃ Р±СѓС„РµСЂР°
   102 000000FA 89F2                    mov edx, esi ; РґР»РёРЅР° Р±СѓС„РµСЂР°
   103 000000FC CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
   104 000000FE EB2D                    jmp Exit
   105                                  Error:
   106 00000100 B804000000                  mov eax, 4 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 4 (write)
   107 00000105 BB01000000                  mov ebx, 1 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdout=1
   108 0000010A B9[22000000]                mov ecx, ErrorStr ; Р°РґСЂРµСЃ СЃРѕРѕР±С‰РµРЅРёСЏ РѕР± РѕС€РёР±РєРµ
   109 0000010F BA1C000000                  mov edx, lenError ; РґР»РёРЅР° СЃРѕРѕР±С‰РµРЅРёСЏ РѕР± РѕС€РёР±РєРµ
   110 00000114 CD80                        int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
   111                                  ; Р’С‹С…РѕРґ
   112                                  Buffer:
   113 00000116 B803000000              mov eax, 3 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 3 (read)
   114 0000011B BB00000000              mov ebx, 0 ; РґРµСЃРєСЂРёРїС‚РѕСЂ С„Р°Р№Р»Р° stdin=0
   115 00000120 B9[00000000]            mov ecx, InBuf ; Р°РґСЂРµСЃ Р±СѓС„РµСЂР° РІРІРѕРґР°
   116 00000125 BA0A000000              mov edx, lenIn ; СЂР°Р·РјРµСЂ Р±СѓС„РµСЂР°
   117 0000012A CD80                    int 80h
   118 0000012C C3                      ret
   119                                  Exit:
   120 0000012D B801000000              mov eax, 1 ; СЃРёСЃС‚РµРјРЅР°СЏ С„СѓРЅРєС†РёСЏ 1 (exit)
   121 00000132 31DB                    xor ebx, ebx ; РєРѕРґ РІРѕР·РІСЂР°С‚Р° 0
   122 00000134 CD80                    int 80h ; РІС‹Р·РѕРІ СЃРёСЃС‚РµРјРЅРѕР№ С„СѓРЅРєС†РёРё
   123                                  %include "../lib.asm"
     1                              <1>     section _text
     2                              <1> StrToInt:
     3 00000000 57                  <1>          push   edi
     4 00000001 B739                <1>          mov    bh, '9'
     5 00000003 B330                <1>          mov    bl, '0'
     6 00000005 56                  <1>          push   esi     ; сохраняем адрес исходной строки
     7 00000006 803E2D              <1>          cmp    byte[esi], '-'
     8 00000009 7501                <1>          jne   .prod
     9 0000000B 46                  <1>          inc    esi     ; пропускаем знак
    10 0000000C FC                  <1> .prod    cld
    11 0000000D 6631FF              <1>          xor    di, di  ; обнуляем будущее число
    12 00000010 AC                  <1> .cycle:  lodsb          ; загружаем символ (цифру)
    13 00000011 3C0A                <1>          cmp    al, 10  ; если 10, то на конец
    14 00000013 741F                <1>          je     .Return
    15 00000015 38D8                <1>          cmp    al, bl  ; сравниваем с кодом нуля
    16 00000017 722F                <1>          jb     .Error  ; "ниже" – Ошибка
    17 00000019 38F8                <1>          cmp    al, bh  ; сравниваем с кодом девяти 
    18 0000001B 772B                <1>          ja     .Error  ; "выше" – Ошибка
    19 0000001D 2C30                <1>          sub    al, 30h ; получаем цифру из символа
    20 0000001F 6698                <1>          cbw            ; расширяем до слова
    21 00000021 6650                <1>          push   ax      ; сохраняем в стеке
    22 00000023 66B80A00            <1>          mov    ax, 10  ; заносим 10 в AX
    23 00000027 66F7E7              <1>          mul    di      ; умножаем, результат в DX:AX
    24 0000002A 665F                <1>          pop    di      ; в DI – очередная цифра
    25 0000002C 6601F8              <1>          add    ax, di
    26 0000002F 6689C7              <1>          mov    di, ax  ; в DI – накопленное число        
    27 00000032 EBDC                <1>          jmp    .cycle
    28 00000034 5E                  <1> .Return: pop    esi
    29 00000035 BB00000000          <1>          mov    ebx, 0
    30 0000003A 803E2D              <1>          cmp    byte[esi], '-'
    31 0000003D 7503                <1>          jne    .J
    32 0000003F 66F7DF              <1>          neg    di
    33 00000042 6689F8              <1> .J       mov    ax, di
    34 00000045 98                  <1>          cwde
    35 00000046 EB0B                <1>          jmp    .R
    36 00000048 5E                  <1> .Error:  pop    esi
    37 00000049 B800000000          <1>          mov    eax, 0
    38 0000004E BB01000000          <1>          mov    ebx, 1
    39 00000053 5F                  <1> .R       pop    edi
    40 00000054 C3                  <1>          ret
    41                              <1> IntToStr: 
    42 00000055 57                  <1>          push   edi
    43 00000056 53                  <1>          push   ebx
    44 00000057 52                  <1>          push   edx
    45 00000058 51                  <1>          push   ecx
    46 00000059 56                  <1> 		 push   esi
    47 0000005A C60600              <1> 		 mov    byte[esi],0 ; на место знака
    48 0000005D 83F800              <1>          cmp    eax,0
    49 00000060 7D05                <1>          jge    .l1
    50 00000062 F7D8                <1>          neg    eax
    51 00000064 C6062D              <1>          mov    byte[esi],'-'
    52 00000067 C646060A            <1> .l1      mov    byte[esi+6],10
    53 0000006B BF05000000          <1>          mov    edi,5
    54 00000070 66BB0A00            <1>          mov    bx,10
    55 00000074 6699                <1> .again:  cwd           ; расширили слово до двойного
    56 00000076 66F7F3              <1>          div    bx     ; делим результат на 10
    57 00000079 80C230              <1>          add    dl,30h ; получаем из остатка код цифры
    58 0000007C 88143E              <1>          mov    [esi+edi],dl ; пишем символ в строку
    59 0000007F 4F                  <1>          dec    edi    ; переводим указатель на  
    60                              <1>                        ; предыдущую позицию
    61 00000080 6683F800            <1>          cmp    ax, 0  ; преобразовали все число?
    62 00000084 75EE                <1>          jne    .again
    63 00000086 B906000000          <1>          mov    ecx, 6
    64 0000008B 29F9                <1>          sub    ecx, edi ; длина результата+знак
    65 0000008D 89C8                <1> 		 mov    eax,ecx
    66 0000008F 40                  <1> 		 inc    eax      ; длина результата+0А
    67 00000090 46                  <1>          inc    esi      ; пропускаем знак
    68 00000091 56                  <1> 		 push   esi
    69 00000092 8D343E              <1>          lea    esi,[esi+edi] ; начало результата
    70 00000095 5F                  <1> 		 pop    edi
    71 00000096 F3A4                <1>          rep movsb
    72 00000098 5E                  <1>          pop    esi  
    73 00000099 59                  <1>          pop    ecx
    74 0000009A 5A                  <1>          pop    edx
    75 0000009B 5B                  <1>          pop    ebx
    76 0000009C 5F                  <1>          pop    edi
    77 0000009D C3                  <1>          ret
   124                                  
   125                                  
   126                                  
   127                                  
   128                                  
   129                                  
